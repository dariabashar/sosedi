# üöÄ –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Sosedi Backend

## üìã –ß—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å

‚úÖ **–†–∞–±–æ—Ç–∞—é—â–∏–π Node.js —Å–µ—Ä–≤–µ—Ä** —Å API endpoints  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ MongoDB –∏ Firebase  
‚úÖ **–ì–æ—Ç–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
‚úÖ **–ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏  

## üóÑÔ∏è –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB Atlas

### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [MongoDB Atlas](https://www.mongodb.com/atlas)
2. –ù–∞–∂–º–∏—Ç–µ "Try Free"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
1. –í—ã–±–µ—Ä–∏—Ç–µ "Build a Database"
2. –í—ã–±–µ—Ä–∏—Ç–µ "FREE" –ø–ª–∞–Ω (M0)
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (AWS/Google Cloud/Azure)
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω (–±–ª–∏–∂–∞–π—à–∏–π –∫ –≤–∞–º)
5. –ù–∞–∂–º–∏—Ç–µ "Create"

### 1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
1. **Database Access** - —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   - Username: `sosedi_admin`
   - Password: `your_secure_password`
   - Role: `Atlas admin`

2. **Network Access** - —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø:
   - –ù–∞–∂–º–∏—Ç–µ "Add IP Address"
   - –í—ã–±–µ—Ä–∏—Ç–µ "Allow Access from Anywhere" (0.0.0.0/0)

### 1.4 –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
1. –ù–∞–∂–º–∏—Ç–µ "Connect"
2. –í—ã–±–µ—Ä–∏—Ç–µ "Connect your application"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üî• –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase

### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Firebase Console](https://console.firebase.google.com/)
2. –ù–∞–∂–º–∏—Ç–µ "Create a project"
3. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: `sosedi-app`
4. –û—Ç–∫–ª—é—á–∏—Ç–µ Google Analytics (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –ù–∞–∂–º–∏—Ç–µ "Create project"

### 2.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ "Authentication"
2. –ù–∞–∂–º–∏—Ç–µ "Get started"
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Sign-in method"
4. –í–∫–ª—é—á–∏—Ç–µ "Phone" (–¥–ª—è SMS –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
5. –ù–∞–∂–º–∏—Ç–µ "Save"

### 2.3 –ü–æ–ª—É—á–µ–Ω–∏–µ Service Account Key
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ (—à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞) –≤—ã–±–µ—Ä–∏—Ç–µ "Project settings"
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Service accounts"
3. –ù–∞–∂–º–∏—Ç–µ "Generate new private key"
4. –°–∫–∞—á–∞–π—Ç–µ JSON —Ñ–∞–π–ª

## ‚öôÔ∏è –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 3.1 –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ env.example
cp env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
nano .env
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env`:
```env
# Server Configuration
PORT=3000
NODE_ENV=development

# MongoDB Configuration (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
MONGODB_URI=mongodb+srv://sosedi_admin:your_password@cluster0.xxxxx.mongodb.net/sosedi?retryWrites=true&w=majority

# Firebase Configuration (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON —Ñ–∞–π–ª–∞)
FIREBASE_PROJECT_ID=sosedi-app
FIREBASE_PRIVATE_KEY_ID=your-private-key-id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@sosedi-app.iam.gserviceaccount.com
FIREBASE_CLIENT_ID=your-client-id
FIREBASE_AUTH_URI=https://accounts.google.com/o/oauth2/auth
FIREBASE_TOKEN_URI=https://oauth2.googleapis.com/token
FIREBASE_AUTH_PROVIDER_X509_CERT_URL=https://www.googleapis.com/oauth2/v1/certs
FIREBASE_CLIENT_X509_CERT_URL=https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-xxxxx%40sosedi-app.iam.gserviceaccount.com

# File Upload Configuration
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880
```

### 3.2 –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –ü—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º (–±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
node working-server.js

# –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º (—Å MongoDB –∏ Firebase)
node src/server.js
```

## üß™ –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 4.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞
```bash
curl http://localhost:3000/api/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "message": "Sosedi API is running (Full Mode)",
  "timestamp": "2025-07-31T14:00:00.000Z",
  "database": "connected",
  "firebase": "configured"
}
```

### 4.2 –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl -X POST http://localhost:3000/api/users/profile \
  -H "Content-Type: application/json" \
  -d '{
    "firebaseUid": "test_user_123",
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ò–≤–∞–Ω–æ–≤",
    "phoneNumber": "+7 999 123-45-67",
    "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 1",
    "location": {
      "type": "Point",
      "coordinates": [37.6176, 55.7558]
    }
  }'
```

### 4.3 –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
```bash
curl -X POST http://localhost:3000/api/posts \
  -H "Content-Type: application/json" \
  -d '{
    "authorId": "test_user_123",
    "text": "–ü—Ä–∏–≤–µ—Ç, —Å–æ—Å–µ–¥–∏! –ö—Ç–æ –∑–Ω–∞–µ—Ç, –≥–¥–µ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å —Ö–æ—Ä–æ—à–∏–π —Ö–ª–µ–±?",
    "location": {
      "type": "Point",
      "coordinates": [37.6176, 55.7558]
    }
  }'
```

### 4.4 –ü–æ–∏—Å–∫ –ø–æ—Å—Ç–æ–≤ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
```bash
curl "http://localhost:3000/api/posts?lat=55.7558&lng=37.6176&radius=1000"
```

## üì± –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Flutter

### 5.1 –û–±–Ω–æ–≤–∏—Ç—å URL API
–í Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–∏—Ç—å URL:
```dart
const String baseUrl = 'http://localhost:3000/api';
```

### 5.2 –û–±–Ω–æ–≤–∏—Ç—å Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
–í `lib/firebase_options.dart`:
```dart
static const FirebaseOptions currentPlatform = FirebaseOptions(
  apiKey: 'your-api-key',
  appId: 'your-app-id',
  messagingSenderId: 'your-sender-id',
  projectId: 'sosedi-app',
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
);
```

### 5.3 –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Flutter
```dart
import 'package:http/http.dart' as http;
import 'dart:convert';

class ApiService {
  static const String baseUrl = 'http://localhost:3000/api';
  
  // –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å—Ç—ã –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
  static Future<List<dynamic>> getNearbyPosts(double lat, double lng) async {
    final response = await http.get(
      Uri.parse('$baseUrl/posts?lat=$lat&lng=$lng&radius=1000')
    );
    
    if (response.statusCode == 200) {
      final data = json.decode(response.body);
      return data['data'];
    } else {
      throw Exception('Failed to load posts');
    }
  }
  
  // –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
  static Future<Map<String, dynamic>> createPost(String authorId, String text, Map<String, dynamic> location) async {
    final response = await http.post(
      Uri.parse('$baseUrl/posts'),
      headers: {'Content-Type': 'application/json'},
      body: json.encode({
        'authorId': authorId,
        'text': text,
        'location': location,
      }),
    );
    
    if (response.statusCode == 200) {
      return json.decode(response.body);
    } else {
      throw Exception('Failed to create post');
    }
  }
}
```

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ API Endpoints

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /api/users` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `POST /api/users/profile` - —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

### –ü–æ—Å—Ç—ã
- `GET /api/posts` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å—Ç—ã (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏)
- `POST /api/posts` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç

### –ì—Ä—É–ø–ø—ã
- `GET /api/groups` - –ø–æ–ª—É—á–∏—Ç—å –≥—Ä—É–ø–ø—ã (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏)
- `POST /api/groups` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É

### –û–±—ä—è–≤–ª–µ–Ω–∏—è
- `GET /api/advertisements` - –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π)
- `POST /api/advertisements` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ

### –°–æ–±—ã—Ç–∏—è
- `GET /api/events` - –ø–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏)
- `POST /api/events` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ

### –ß–∞—Ç—ã
- `GET /api/chats` - –ø–æ–ª—É—á–∏—Ç—å —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/chats/private` - —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### MongoDB –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ .env
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ IP –∞–¥—Ä–µ—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ Network Access
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ username/password

### Firebase –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Service Account Key
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Firebase Console

### –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `npm install`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å .env —Ñ–∞–π–ª–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

‚úÖ **–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥** —Å MongoDB –∏ Firebase  
‚úÖ **API –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "–°–æ—Å–µ–¥–∏"  
‚úÖ **–ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏  
‚úÖ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** —Å Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è  

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏! 